<div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
  <div class="flex flex-col gap-4 p-4">
    <div class="flex flex-wrap items-center gap-3">
      <label class="text-sm font-medium text-gray-700 dark:text-gray-200" for="employee-filter">Empleado:</label>
      <select
        id="employee-filter"
        class="h-10 min-w-[200px] rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
        (change)="handleEmployeeFilterChange($any($event.target).value || 'all')"
      >
        <option value="all">Todos los empleados</option>
        @for (employee of employees; track employee.id) {
          <option [value]="employee.id">{{ employee.name }}</option>
        }
      </select>
    </div>

    <div class="custom-calendar">
      <full-calendar #calendar [options]="calendarOptions"></full-calendar>
    </div>
  </div>

  <app-modal
    [isOpen]="isOpen"
    (close)="closeModal()"
    className="max-w-[700px] p-6 lg:p-10"
  >
    <div class="flex flex-col px-2 overflow-y-auto custom-scrollbar">
      @if (alerts.length) {
        <div class="flex flex-col gap-3 mb-6">
          @for (alert of alerts; track alert.id) {
            <div class="relative">
              <app-alert
                [variant]="alert.variant"
                [title]="alert.title"
                [message]="alert.message"
              ></app-alert>
              <button
                type="button"
                class="absolute right-3 top-3 text-gray-400 transition hover:text-gray-600 dark:hover:text-gray-200"
                aria-label="Cerrar alerta"
                (click)="dismissAlert(alert.id)"
              >
                ✕
              </button>
            </div>
          }
        </div>
      }
      <div>
        <h5 class="mb-2 font-semibold text-gray-800 modal-title text-theme-xl dark:text-white/90 lg:text-2xl">
          {{ selectedEvent ? 'Editar tarea' : 'Agregar tarea' }}
        </h5>
        <p class="text-sm text-gray-500 dark:text-gray-400">
          Importante colocar localización y empleado.
        </p>
      </div>
      <!-- Event Title - Hidden (generated automatically) -->
      <div class="mt-8 hidden">
        <div>
          <label class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">
            Titulo del evento
          </label>
          <input
            id="event-title"
            type="text"
            [(ngModel)]="eventTitle"
            class="dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"
          />
        </div>
      </div>


      <!-- Enter Start Date - Hidden (obtained from calendar click) -->
      <div class="mt-6 hidden">
        <label class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">
          Enter Start Date
        </label>
        <input
          id="event-start-date"
          type="date"
          [(ngModel)]="eventStartDate"
          class="dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
        />
      </div>

      <div class="mt-6">
        <label class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">
          Localización
        </label>
        <select
          [(ngModel)]="eventLocation"
          class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
        >
          <option value="">Seleccionar localización</option>
          @for (location of locations; track location.id) {
            <option [value]="location.name">{{ location.name }} ({{ location.city }})</option>
          }
        </select>
      </div>

      <div class="mt-6">
        <label class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">
          Empleado Asignado
        </label>
        <select
          [(ngModel)]="eventEmployeeId"
          class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
        >
          <option [ngValue]="undefined">Seleccionar empleado</option>
          @for (employee of employees; track employee.id) {
            <option [ngValue]="employee.id">{{ employee.name }} ({{ employee.rol }})</option>
          }
        </select>
      </div>

      <div class="grid grid-cols-2 gap-4 mt-6">
        <div>
          <label class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">
            Hora de Inicio
          </label>
          <input
            type="time"
            [(ngModel)]="eventStartTime"
            class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
          />
        </div>

        <div>
          <label class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">
            Hora de Fin
          </label>
          <input
            type="time"
            [(ngModel)]="eventEndTime"
            class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
          />
        </div>
      </div>

      <div class="flex items-center gap-3 mt-6 modal-footer sm:justify-end">
        <button
          (click)="closeModal()"
          type="button"
          class="flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 sm:w-auto"
        >
          Close
        </button>
        <button
          (click)="handleAddOrUpdateEvent()"
          type="button"
          class="btn btn-success btn-update-event flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"
        >
          {{ selectedEvent ? 'Update Changes' : 'Add Event' }}
        </button>
      </div>
    </div>
  </app-modal>

  <!-- Modal de eventos por día cuando hay más de 3 -->
  <app-modal
    [isOpen]="isDayModalOpen"
    (close)="isDayModalOpen = false"
    className="max-w-[600px] p-6 lg:p-8"
  >
    <div class="flex flex-col gap-4">
      <div>
        <h5 class="mb-1 font-semibold text-gray-800 text-lg dark:text-white/90">
          Eventos del {{ selectedDay || '' }}
        </h5>
        <p class="text-sm text-gray-500 dark:text-gray-400">
          Lista de tareas para este día.
        </p>
      </div>

      @if (!selectedDayEvents.length) {
        <div class="text-sm text-gray-500 dark:text-gray-400">
          No hay tareas en este día.
        </div>
      } @else {
        <div class="flex flex-col gap-3 max-h-[60vh] overflow-y-auto custom-scrollbar">
          @for (ev of selectedDayEvents; track ev.id) {
            <div class="flex items-center justify-between gap-3 rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 dark:border-gray-800 dark:bg-white/[0.04]">
              <div class="flex items-center gap-3">
                <div
                  class="h-9 w-9 rounded-full flex items-center justify-center text-xs font-semibold text-white"
                  [style.background-color]="ev.employeeColor || '#6366f1'"
                >
                  {{ ev.employeeName ? ev.employeeName[0] : 'T' }}
                </div>
                <div class="flex flex-col text-sm">
                  <span class="font-semibold text-gray-800 dark:text-white/90">{{ ev.employeeName || 'Tarea' }}</span>
                  <span class="text-gray-600 dark:text-gray-300">{{ ev.location || 'Sin localización' }}</span>
                  <span class="text-gray-500 dark:text-gray-400">{{ ev.startTime && ev.endTime ? ev.startTime + ' - ' + ev.endTime : '' }}</span>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <button
                  type="button"
                  class="rounded-md border border-gray-300 px-3 py-1 text-xs font-medium text-gray-700 hover:bg-gray-100 dark:border-gray-700 dark:text-gray-200"
                  (click)="handleDayEventEdit(ev.id)"
                >
                  Editar
                </button>
                <button
                  type="button"
                  class="rounded-md border border-red-200 px-3 py-1 text-xs font-medium text-red-600 hover:bg-red-50 dark:border-red-800"
                  (click)="handleDayEventDelete(ev.id)"
                >
                  Eliminar
                </button>
              </div>
            </div>
          }
        </div>
      }

      <div class="flex items-center gap-3 justify-end pt-2">
        <button
          type="button"
          class="flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 sm:w-auto"
          (click)="isDayModalOpen = false"
        >
          Cerrar
        </button>
        <button
          type="button"
          class="flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"
          (click)="handleDayEventCreate()"
        >
          Nueva tarea en este día
        </button>
      </div>
    </div>
  </app-modal>
</div>
