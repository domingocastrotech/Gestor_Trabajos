<div>
  <app-page-breadcrumb [pageTitle]="isAdmin ? 'Panel de AdministraciÃ³n' : 'Mi Panel Personal'" />

  <!-- Welcome Section -->
  <div class="mb-8 rounded-2xl border border-gray-200 bg-gradient-to-r from-blue-500/10 to-blue-600/10 dark:border-gray-800 dark:from-blue-900/20 dark:to-blue-800/20 p-6">
    <div class="flex items-center gap-4">
      <img [src]="currentEmployee.avatar" alt="Avatar" class="w-16 h-16 rounded-full border-2 border-blue-500" />
      <div>
        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Â¡Bienvenido, {{ currentEmployee.name | utf8Fix }}!</h2>
        <p class="text-gray-600 dark:text-gray-400">
          {{ currentEmployee.role }}
          @if (isAdmin) {
            <span class="ml-2 px-2 py-0.5 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300">Admin</span>
          }
        </p>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 gap-6 mb-8 sm:grid-cols-2 lg:grid-cols-4">
    <!-- Total Tasks -->
    <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">
            @if (isAdmin) {
              Total de Tareas
            } @else {
              Mis Tareas
            }
          </p>
          <h3 class="text-3xl font-bold text-gray-800 dark:text-white">{{ taskStats.total }}</h3>
        </div>
        <div class="text-4xl text-blue-500">ğŸ“‹</div>
      </div>
      <p class="text-xs text-gray-500 dark:text-gray-500 mt-2">
        @if (isAdmin) {
          Todas las tareas del sistema
        } @else {
          Tareas asignadas a ti
        }
      </p>
    </div>

    <!-- Today Tasks -->
    <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">
            @if (isAdmin) {
              Tareas de Hoy
            } @else {
              Mis Tareas Hoy
            }
          </p>
          <h3 class="text-3xl font-bold text-green-600">{{ taskStats.todayTasks }}</h3>
        </div>
        <div class="text-4xl text-green-500">ğŸ“…</div>
      </div>
      <p class="text-xs text-gray-500 dark:text-gray-500 mt-2">{{ todayLabel }}</p>
    </div>

    <!-- This Week Tasks -->
    <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Esta Semana</p>
          <h3 class="text-3xl font-bold text-blue-600">{{ taskStats.thisWeekTasks }}</h3>
        </div>
        <div class="text-4xl text-blue-500">ğŸ“Š</div>
      </div>
      <p class="text-xs text-gray-500 dark:text-gray-500 mt-2">{{ weekLabel }}</p>
    </div>

    <!-- Vacations / Employees -->
    @if (isAdmin) {
      <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Vacaciones Pendientes</p>
            <h3 class="text-3xl font-bold text-orange-600">{{ taskStats.pendingVacations }}</h3>
          </div>
          <div class="text-4xl text-orange-500">ğŸ–ï¸</div>
        </div>
        <p class="text-xs text-gray-500 dark:text-gray-500 mt-2">Solicitudes por aprobar</p>
      </div>
    } @else {
      <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Ubicaciones</p>
            <h3 class="text-3xl font-bold text-purple-600">{{ locations.length }}</h3>
          </div>
          <div class="text-4xl text-purple-500">ğŸ“</div>
        </div>
        <p class="text-xs text-gray-500 dark:text-gray-500 mt-2">Lugares de trabajo</p>
      </div>
    }
  </div>

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">
    <!-- Upcoming Tasks -->
    <div class="lg:col-span-2">
      <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6">
        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-6">
          @if (isAdmin) {
            PrÃ³ximas Tareas del Sistema
          } @else {
            Mis PrÃ³ximas Tareas
          }
        </h3>

        @if (upcomingTasks.length === 0) {
          <div class="py-8 text-center">
            <div class="text-5xl mb-4">âœ…</div>
            <p class="text-gray-600 dark:text-gray-400">No tienes tareas programadas prÃ³ximamente</p>
          </div>
        } @else {
          <div class="space-y-4">
            @for (task of upcomingTasks; track task.id) {
              <div class="flex items-start gap-4 p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700 transition">
                <!-- Employee Avatar -->
                <div class="w-10 h-10 rounded-full flex-shrink-0" [style.background-color]="task.employee_color">
                  <div class="w-full h-full flex items-center justify-center text-white font-semibold text-sm">
                    {{ task.employee_name?.charAt(0) }}
                  </div>
                </div>

                <!-- Task Details -->
                <div class="flex-1">
                  <div class="flex items-start justify-between">
                    <div>
                      <h4 class="font-semibold text-gray-800 dark:text-white">{{ task.title }}</h4>
                      <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">ğŸ“ {{ task.location_name }}</p>
                    </div>
                    <span class="inline-block px-3 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300">
                      {{ formatTimeWithoutSeconds(task.start_time) }} - {{ formatTimeWithoutSeconds(task.end_time) }}
                    </span>
                  </div>
                  <div class="flex items-center gap-2 mt-2">
                    <span class="text-xs text-gray-500 dark:text-gray-500">{{ task.start_date | date: 'dd/MM/yyyy' }}</span>
                    @if (isAdmin) {
                      <span class="w-1 h-1 bg-gray-400 rounded-full"></span>
                      <span class="text-xs text-gray-500 dark:text-gray-500">{{ task.employee_name }}</span>
                    }
                  </div>
                </div>
              </div>
            }
          </div>
        }

        <button
          (click)="navigateToCalendar()"
          class="w-full mt-6 px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 border border-blue-200 dark:border-blue-800 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition">
          Ver calendario completo â†’
        </button>
      </div>
    </div>

    <!-- Weekly Stats & Recent Activity -->
    <div class="flex flex-col gap-8">
      <!-- Weekly Performance -->
      <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6">
        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-6">
          @if (isAdmin) {
            Tareas por DÃ­a (Todas)
          } @else {
            Mis Tareas por DÃ­a
          }
        </h3>

        <div class="space-y-4">
          @for (stat of weeklyStats; track stat.day) {
            <div class="flex items-center gap-3">
              <span class="w-8 text-xs font-medium text-gray-600 dark:text-gray-400">{{ stat.day }}</span>
              <div class="flex-1 h-6 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                @if (stat.tasks > 0) {
                  <div class="h-full bg-blue-500 transition-all" [style.width.%]="stat.tasks * 20"></div>
                }
              </div>
              <span class="text-xs text-gray-600 dark:text-gray-400 w-8 text-right">{{ stat.tasks }}</span>
            </div>
          }
        </div>

        @if (isAdmin) {
          <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
            <div class="grid grid-cols-3 gap-4 text-center">
              <div>
                <p class="text-2xl font-bold text-blue-600">{{ employees.length }}</p>
                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Empleados</p>
              </div>
              <div>
                <p class="text-2xl font-bold text-green-600">{{ locations.length }}</p>
                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Ubicaciones</p>
              </div>
              <div>
                <p class="text-2xl font-bold text-orange-600">{{ taskStats.pendingVacations }}</p>
                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Pendientes</p>
              </div>
            </div>
            <div class="mt-4 flex gap-2">
              <button (click)="navigateToEmployees()" class="flex-1 px-3 py-2 text-xs font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 border border-blue-200 dark:border-blue-800 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition">
                Ver Empleados
              </button>
              <button (click)="navigateToLocations()" class="flex-1 px-3 py-2 text-xs font-medium text-green-600 hover:text-green-700 dark:text-green-400 border border-green-200 dark:border-green-800 rounded-lg hover:bg-green-50 dark:hover:bg-green-900/20 transition">
                Ver Ubicaciones
              </button>
            </div>
          </div>
        } @else {
          <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
            <p class="text-sm text-gray-600 dark:text-gray-400 text-center">
              Esta semana: <span class="font-semibold text-gray-800 dark:text-white">{{ taskStats.thisWeekTasks }} {{ taskStats.thisWeekTasks === 1 ? 'tarea' : 'tareas' }}</span>
            </p>
          </div>
        }
      </div>

    </div>
  </div>
</div>
